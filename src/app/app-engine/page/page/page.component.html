<app-load-variables
  (sendPageBack)="receivePage( $event )"
  (sendOpenAppsInThisPageBack)="receiveOpenAppsInThisPage( $event )"
  [reload]="reloadVariables">

</app-load-variables>

<app-data-assignment
  [index]="index"
  [openAppsInThisPage]="openAppsInThisPage"
  [appInputQueryMapping]="page.appInputQueryMapping"
  [response]="response"
  [queryId] = "queryId"
  [depth]="depth"
  [updateLinkedApps]="updateLinkedApps"
  [indexAppMapping]="indexAppMapping"
  (sendAppTypesBackToNIEOS)="receiveOpenAppsInThisPage( $event )">

</app-data-assignment>

<ngx-spinner
  bdColor = "rgba(51, 51, 51, 0.8)"
  size = "large"
  color = "#fff"
  type = "cube-transition"
></ngx-spinner>

  <!-- Menu to open Apps-->
  <mat-drawer-container  style="height:100vh; margin-top: 30px;" >
    <mat-drawer #drawer mode="side" [opened]="true">

      <div *ngIf="!pageAsDemo">
        <h4 style="align-content: center" i18n="@@yourPageTitle">Your Page</h4>
        <button mat-button (click)="updatePage()" i18n="@@savePageButton">Save Page</button>
        <button mat-button (click)="expandPanels()" i18n="@@toggleDescriptionButton"> Un/fold description</button><br>
        <button mat-button (click)="openDataManagement()" i18n="@@pageDataManagementLink">Page Data Management</button><br>
        <button mat-button (click)="changeAppFramePosition()" > Tiled or floating apps </button>
<!--        <h4 style="align-content: center">GrapesJS</h4>-->
<!--        <button mat-button (click)="activateGrapesJS()" i18n="@@addGrapeJsButton">Add GrapesJS</button>-->
<!--        <button mat-button (click)="deactivateGrapesJS()" i18n="@@removeGrapeJsButton">Remove GrapesJS</button><br>-->
<!--        <button mat-button (click)="deleteGrapesJSData()" i18n="@@deleteGrapeJsDataButton">Delete GrapesJS Data</button>-->
<!--        <button mat-button (click)="addBlock()" i18n="@@addBlockButton">Add Block</button>-->
      </div>

      <div *ngIf="pageAsDemo">
        <h4 style="align-content: center" i18n="@@demoPageTitle">Demo - Page</h4>
        <ng-container i18n="@@registerForFullPageFunctionalityMessage">
          You can not save anything you do on this <br> demo - page. If you would like to save <br> pages and pageSets, please register
        </ng-container>
        <a href="/register" i18n="@@hereLinkLabel">here</a>.
      </div>

      <!-- Data Chooser -->
      <h4 style="align-content: center" *ngIf="openAppsInThisPage[ 'dataChooser' ].model.length > 0" i18n="@@QueriesLabel">Queries</h4>
      <div *ngFor="let dataChooser of openAppsInThisPage[ 'dataChooser' ].model; let i = index;" >
        <button
          *ngIf="openAppsInThisPage[ 'dataChooser' ].model[i].title.search( 'Depth: ' ) === -1"
          (click)="openQueryInformationDialog( openAppsInThisPage[ 'dataChooser' ].model[i].queryId, openAppsInThisPage[ 'dataChooser' ].model[i].title )"
          mat-button>
          {{ openAppsInThisPage[ 'dataChooser' ].model[i].title }}
        </button>
        <div style="width: 300px; height: 50px;" >
          <app-data-chooser
            [appInputQueryMapping]=" page.appInputQueryMapping"
            [response]="openAppsInThisPage[ 'dataChooser' ].model[i].response"
            [queryId] = "openAppsInThisPage[ 'dataChooser' ].model[i].queryId"
            [openAppsInThisPage] = "openAppsInThisPage"
            [dataChooserEntries]="openAppsInThisPage[ 'dataChooser' ].model[i].dataChooserEntries"
            [description]=" 'Depth: ' + openAppsInThisPage[ 'dataChooser' ].model[i].depth "
            [depth]="openAppsInThisPage[ 'dataChooser' ].model[i].depth"
            (sendIndexBack)="updateMainResourceIndex( $event )">
          </app-data-chooser>
        </div>
      </div>



      <!-- Texts -->
      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;" i18n="@@textAppsLabel">Text</h4><h4 style="align-content: center; display: inline; color: #4dc71f" i18n="@@appsLabel">&nbsp;Apps</h4></summary>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header >
            <mat-panel-title i18n="@@textViewerAppLabel">
              Text Viewer
            </mat-panel-title>
            <mat-panel-description i18n="@@textViewerAppDescription">
              Displays searchable Text
            </mat-panel-description>
          </mat-expansion-panel-header>

          <ng-container i18n="@@appUnderDevelopmentLabel">
            This app is under development.
          </ng-container>
          <ng-container i18n="@@textViewerApp">
            It displays searchable text which can be changed regarding the font size, the design.
          </ng-container>

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('textViewer', true)"><mat-icon>view_headline</mat-icon> Add Text Viewer</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Plaintext Viewer <span style="color: #4dc71f" >✓</span>
            </mat-panel-title>
            <mat-panel-description>
              Displays searchable Text
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app can be combined with the data - chooser. A tutorial on how to use the data - chooser will follow.

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('textlistViewers', true)"><mat-icon>short_text</mat-icon>Add Textlist - Viewer</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              SVG-Transcription
            </mat-panel-title>
            <mat-panel-description>
              svg-text
            </mat-panel-description>
          </mat-expansion-panel-header>

          SVG transcription with exact word positions

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('svgTranscription', true)">Add SVG Transcription View</button><br>

        </mat-expansion-panel>

      </details>

      <!-- project specific -->
      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;">Project Specific</h4><h4 style="align-content: center; display: inline; color: #4dc71f">&nbsp;Apps</h4></summary>

        <mat-expansion-panel style="width: 300px; padding-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Parzival - Fassung <span style="color: #4dc71f" >✓</span>
            </mat-panel-title>
            <mat-panel-description>
              shortname: pF
            </mat-panel-description>
          </mat-expansion-panel-header>

          Project specific App for the Parzival Project

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('parzivalFassung', true)">Add Parzival Fassung</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              AVP-Edition
            </mat-panel-title>
            <mat-panel-description>
              avp-e
            </mat-panel-description>
          </mat-expansion-panel-header>

          Project specific App for the AVP Project

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('avpEditionView', true)">Add AVP Edition View</button><br>

        </mat-expansion-panel>
      </details>

      <!-- Images -->
      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;">Image</h4><h4 style="align-content: center; display: inline; color: #4dc71f">&nbsp;Apps</h4></summary>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >

          <mat-expansion-panel-header>
            <mat-panel-title>
              Image Viewer <span style="color: #4dc71f" >✓</span>
            </mat-panel-title>
            <mat-panel-description>
              Display and zoom in images
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app displays the image of your choice with the OpenSea - Dragon - Plugin. You can zoom in and have
          a look at it in fullscreen - mode. The documentation of this App can be found
          <a href="https://nie-ine.github.io/nieOS/components/ImageFrameComponent.html" target="_blank">here</a>.

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('imageViewer', true)" >
            <mat-icon >image</mat-icon>
            Add Image Viewer</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Simple Image App <span style="color: #4dc71f" >✓</span>
            </mat-panel-title>
            <mat-panel-description>
              Displays simple image
            </mat-panel-description>
          </mat-expansion-panel-header>
          Description
          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('simpleImageApp', true)"><mat-icon>add_photo_alternate</mat-icon>Add Image - Viewer</button><br>

        </mat-expansion-panel>
      </details>

      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;">Search & Retrieve</h4><h4 style="align-content: center; display: inline; color: #4dc71f">&nbsp;Apps</h4></summary>

      <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
        <mat-expansion-panel-header>
          <mat-panel-title>
            Simple Full Text Search
          </mat-panel-title>
          <mat-panel-description>
            Search in all resources
          </mat-panel-description>
        </mat-expansion-panel-header>

        This app searches in all resources of your project and provides a simple output. It is still under development.

        <mat-divider></mat-divider>

        <button mat-button (click)="addAnotherApp('searchViewer', true)">
          <mat-icon >search</mat-icon>
          Add search Viewer
        </button><br>

      </mat-expansion-panel>

      <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
        <mat-expansion-panel-header>
          <mat-panel-title>
            Data list viewer
          </mat-panel-title>
          <mat-panel-description>
            Displays query results in a table format.
          </mat-panel-description>
        </mat-expansion-panel-header>

        This app can be combined with the data - chooser. A tutorial on how to use the data - chooser will follow.

        <mat-divider></mat-divider>

        <button mat-button (click)="addAnotherApp('dataListView', true)"><mat-icon>short_text</mat-icon>Add a data list / data table</button><br>
      </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Tree navigation
            </mat-panel-title>
            <mat-panel-description>
              Displays a navigable tree structure.
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app can be combined with apps for resource view.

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('treeNavigation', true)"><mat-icon>short_text</mat-icon>Add a tree navigation</button><br>
        </mat-expansion-panel>

      </details>

      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;">Multimedia</h4><h4 style="align-content: center; display: inline; color: #4dc71f">&nbsp;Apps</h4></summary>

      <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
        <mat-expansion-panel-header>
          <mat-panel-title>
            Synopsis Viewer
          </mat-panel-title>
          <mat-panel-description>
            Compare images and texts
          </mat-panel-description>
        </mat-expansion-panel-header>

        This app is under development. It has the functionality of a light - table and can compare image and text objects.
        It is currently working much better as an own window and can be opened as an own window <a href="/synopsis" target="_blank">here</a>.

        <mat-divider></mat-divider>

        <button mat-button (click)="addAnotherApp('synopsisViewer', true)"><mat-icon>art_track</mat-icon> Add Synopsis Viewer</button><br>
      </mat-expansion-panel>

      <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
        <mat-expansion-panel-header>
          <mat-panel-title>
            Json Viewer <span style="color: #4dc71f" >✓</span>
          </mat-panel-title>
          <mat-panel-description>
            Visualise Json Data
          </mat-panel-description>
        </mat-expansion-panel-header>

        This app visualizes json objects as a tree.

        <mat-divider></mat-divider>

        <button mat-button (click)="addAnotherApp('jsonViewer', true)"><mat-icon>spa</mat-icon> Add Data Chooser</button><br>

      </mat-expansion-panel>

      </details>

      <!-- Data visualization -->
      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;">Visualisation</h4><h4 style="align-content: center; display: inline; color: #4dc71f">&nbsp;Apps</h4></summary>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Bar Chart
            </mat-panel-title>
            <mat-panel-description>
              To define data with two dimensions
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('barCharts', true)"><mat-icon>bar_chart</mat-icon> Add Bar Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Spiral Bar Chart
            </mat-panel-title>
            <mat-panel-description>
              To define data large bar charts
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('spiralBarCharts', true)"><mat-icon>bar_chart</mat-icon> Add Bar Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Line Chart
            </mat-panel-title>
            <mat-panel-description>
              To define data with two dimensions
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('lineCharts', true)"><mat-icon>show_chart</mat-icon> Add Line Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Brush Zoom
            </mat-panel-title>
            <mat-panel-description>
              To define data with two dimensions
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('brushZoomCharts' , true)"><mat-icon>insert_chart_outlined</mat-icon> Add Brush Zoom Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Leaflet map
            </mat-panel-title>
            <mat-panel-description>
              Visualize data on maps
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('leafletMaps', true)"><mat-icon>add_location</mat-icon> Add Leaflet Map</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Pie Chart
            </mat-panel-title>
            <mat-panel-description>
              To visualise subsets
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('pieCharts', true)"><mat-icon>pie_chart</mat-icon> Add Pie Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Radial Bar Chart
            </mat-panel-title>
            <mat-panel-description>
              To two dimensional data
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('radialBarCharts', true)"><mat-icon>multiline_chart</mat-icon> Add Radial Bar Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Sankey
            </mat-panel-title>
            <mat-panel-description>
              To display dependend data
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('sankeyCharts', true)"><mat-icon>linear_scale</mat-icon> Add Sankey Chart</button><br>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Stacked Bar Chart
            </mat-panel-title>
            <mat-panel-description>
              To display grouped sets
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('stackedBarCharts', true)"><mat-icon>view_list</mat-icon> Add Stacked Bar Chart</button><br>

        </mat-expansion-panel>


        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Chord diagram
            </mat-panel-title>
            <mat-panel-description>
              To compare intensity of connections
            </mat-panel-description>
          </mat-expansion-panel-header>

          This app is under development

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('chordDiagrams', true)"><mat-icon>all_out</mat-icon> Add Chord Diagram</button><br>

        </mat-expansion-panel>
      </details>

      <!-- Data insertion -->
      <details style="margin-top: 35px; width: 300px;">
        <summary style="cursor: pointer"><h4 style="align-content: center; display: inline;">Insertion</h4><h4 style="align-content: center; display: inline; color: #4dc71f">&nbsp;Apps</h4></summary>



        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Resource Creation
            </mat-panel-title>
            <mat-panel-description>
              For Knora
            </mat-panel-description>
          </mat-expansion-panel-header>

          With this app you can create data in Knora.

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('createResourceForm', true)"><mat-icon>add_to_queue</mat-icon> Add Creation Form</button>

        </mat-expansion-panel>

        <mat-expansion-panel style="width: 300px; margin-top: 10px;" [expanded]="panelsOpen" >
          <mat-expansion-panel-header>
            <mat-panel-title>
              Edit Resource
            </mat-panel-title>
            <mat-panel-description>
              For Knora
            </mat-panel-description>
          </mat-expansion-panel-header>

          With this app you can change data in Knora and see the history of given properties.

          <mat-divider></mat-divider>

          <button mat-button (click)="addAnotherApp('editResourceForm', true)"><mat-icon>add_to_queue</mat-icon> Add Edit Form</button>

        </mat-expansion-panel>
      </details>

    </mat-drawer>

<!--    <div *ngIf="grapesJSActivated" id="grapesJSViewer" style="z-index: -1; position: absolute; "></div>-->



      <div style="margin-top: 30px; vertical-align: bottom;">
        <button type="button" mat-button (click)="drawer.toggle()" matTooltip='{{ createTooltip() }}'>
          <mat-icon color="primary" >chrome_reader_mode</mat-icon> <h4 style="align-content: center" *ngIf="pageAsDemo">Demo</h4>
        </button>
      </div>

      <!-- Image Viewer -->
      <div *ngFor="let imageViewer of openAppsInThisPage[ 'imageViewer' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>image</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="imageViewer.appear()">Show Image Viewer {{ i }}</button>
          <button mat-menu-item >Choose Image</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'imageViewer' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #imageViewer
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'imageViewer' ].model[i].hash"
               [title]="openAppsInThisPage[ 'imageViewer' ].model[i].title || 'Image Viewer ' + i "
               [type]="openAppsInThisPage[ 'imageViewer' ].type"
               [firstPopupX]="openAppsInThisPage[ 'imageViewer' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'imageViewer' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'imageViewer' ].model[i].width, '500' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'imageViewer' ].model[i].height, '700')"
               [index] = "openAppsInThisPage[ 'imageViewer' ].model[i].index"
               [arrayLength] = "openAppsInThisPage[ 'imageViewer' ].model[i].arrayLength"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               [queryId] = "openAppsInThisPage[ 'imageViewer' ].model[i].queryId"
               (sendIndexBack)="updateIndices( $event )"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'imageViewer' ].model[i].height, '700' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'imageViewer' ].model[i].width, '500' ) + 'px'}">
          <app-image-with-overlay style="position: sticky;"
                                  [iiifImagePath]="openAppsInThisPage[ 'imageViewer' ].model[i][ 'fileValueAsUrl' ]"
                                  [maxImageWidth]="openAppsInThisPage[ 'imageViewer' ].model[i][ 'stillImageFileValueHasDimX' ]"
                                  [maxImageHeight]="openAppsInThisPage[ 'imageViewer' ].model[i][ 'stillImageFileValueHasDimY' ]"
                                  width="500"
                                  height="700">
          </app-image-with-overlay>
          </div>
        </popup>
      </div>

      <!-- Search -->
      <div *ngFor="let search of openAppsInThisPage[ 'searchViewer' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>search</mat-icon> {{ i }} </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="searchViewer.appear()" >Show Search Viewer {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'searchViewer' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #searchViewer
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'searchViewer' ].model[i].hash"
               [title]="openAppsInThisPage[ 'searchViewer' ].model[i].title || 'Search ' + i"
               [type]="openAppsInThisPage[ 'searchViewer' ].type"
               [firstPopupX]="openAppsInThisPage[ 'searchViewer' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'searchViewer' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'searchViewer' ].model[i].width, '250' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'searchViewer' ].model[i].height, '400')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'searchViewer' ].model[i].height, '400' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'searchViewer' ].model[i].width, '250' ) + 'px'}">
          <!--<nie-search-->
            <!--style="position: sticky;">-->

          <!--</nie-search>-->
          </div>
        </popup>
      </div>

    <!-- Simple Image App -->
    <div *ngFor="let image of openAppsInThisPage[ 'simpleImageApp' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>add_photo_alternate</mat-icon> {{ i }} </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="simpleImageApp.appear()" >Show Image Viewer {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'simpleImageApp' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #simpleImageApp
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'simpleImageApp' ].model[i].hash"
             [title]="openAppsInThisPage[ 'simpleImageApp' ].model[i].title || 'Image' + i"
             [type]="openAppsInThisPage[ 'simpleImageApp' ].type"
             [firstPopupX]="openAppsInThisPage[ 'simpleImageApp' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'simpleImageApp' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'simpleImageApp' ].model[i].width, '500' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'simpleImageApp' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'simpleImageApp' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'simpleImageApp' ].model[i].width, '500' ) + 'px'}">
        <app-simple-image-app
          style="position: sticky;"
          [imageURL]="openAppsInThisPage[ 'simpleImageApp' ].model[i]['imageURL']">

        </app-simple-image-app>
        </div>
      </popup>
    </div>

      <!-- TextViewer -->
      <div *ngFor="let textViewer of openAppsInThisPage[ 'textViewer' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>short_text</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="textViewer.appear()" >Show Text Viewer {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'textViewer' ].model, i ) ">Remove this app</button>
          <button mat-menu-item>Choose Text</button>
        </mat-menu>
        <popup #textViewer
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'textViewer' ].model[i].hash"
               [title]="openAppsInThisPage[ 'textViewer' ].model[i].title || 'Text Viewer ' + i"
               [type]="openAppsInThisPage[ 'textViewer' ].type"
               [firstPopupX]="openAppsInThisPage[ 'textViewer' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'textViewer' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'textViewer' ].model[i].width, '500' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'textViewer' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'textViewer' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'textViewer' ].model[i].width, '500' ) + 'px'}">
            <app-text-view class="draggable" style="position: sticky;">
            </app-text-view>
          </div>
        </popup>
      </div>

      <!-- Synopsis -->
      <div *ngFor="let synopsisViewer of openAppsInThisPage[ 'synopsisViewer' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>art_track</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="synopsisViewer.appear()" >Show Synopsis Viewer {{ i }}</button><br>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'synopsisViewer' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #synopsisViewer
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'synopsisViewer' ].model[i].hash"
               [title]="openAppsInThisPage[ 'synopsisViewer' ].model[i].title || 'Synopsis Viewer ' + i"
               [type]="openAppsInThisPage[ 'synopsisViewer' ].type"
               [firstPopupX]="openAppsInThisPage[ 'synopsisViewer' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'synopsisViewer' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'synopsisViewer' ].model[i].width, '900' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'synopsisViewer' ].model[i].height, '400')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'synopsisViewer' ].model[i].height, '150' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'synopsisViewer' ].model[i].width, '250' ) + 'px'}">
            <app-synopsis style="position: sticky;">

            </app-synopsis>
          </div>
        </popup>
      </div>

      <!-- Resource Creation Form -->
      <div *ngFor="let createResourceForm of openAppsInThisPage[ 'createResourceForm' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>add_to_queue</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="createResourceForm.appear()" >Show Create Resource Form {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'createResourceForm' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #createResourceForm
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'createResourceForm' ].model[i].hash"
               [title]="openAppsInThisPage[ 'createResourceForm' ].model[i].title ||  'Resource Creation ' + i"
               [type]="openAppsInThisPage[ 'createResourceForm' ].type"
               [firstPopupX]="openAppsInThisPage[ 'createResourceForm' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'createResourceForm' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'createResourceForm' ].model[i].width, '900' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'createResourceForm' ].model[i].height, '400')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'createResourceForm' ].model[i].height, '400' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'createResourceForm' ].model[i].width, '900' ) + 'px'}" >
            <app-create-resource style="position: sticky;"
                                 [projectIRI]="projectIRI"
                                 (resourceIRI)="closeApp( openAppsInThisPage[ 'createResourceForm' ].model, i )">
            </app-create-resource>
          </div>
        </popup>
      </div>

    <!-- Edit Resource Form -->
    <div *ngFor="let editResourceForm of openAppsInThisPage[ 'editResourceForm' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>add_to_queue</mat-icon> {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="editResourceForm.appear()" >Show Create Resource Form {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'editResourceForm' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #editResourceForm
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'editResourceForm' ].model[i].hash"
             [title]="openAppsInThisPage[ 'editResourceForm' ].model[i].title ||  'Edit Resource ' + i"
             [type]="openAppsInThisPage[ 'editResourceForm' ].type"
             [firstPopupX]="openAppsInThisPage[ 'editResourceForm' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'editResourceForm' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'editResourceForm' ].model[i].width, '900' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'editResourceForm' ].model[i].height, '400')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'editResourceForm' ].model[i].height, '400' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'editResourceForm' ].model[i].width, '900' ) + 'px'}" >
          <app-resource-form (resourceIsDeleted)="closeApp( openAppsInThisPage[ 'createResourceForm' ].model, i )">
          </app-resource-form>
        </div>
      </popup>
    </div>


    <!-- textlistViewers -->
      <div *ngFor="let createResourceForm of openAppsInThisPage[ 'textlistViewers' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>short_text</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="textlistViewers.appear()" >Show Textlist Viewer {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'textlistViewers' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #textlistViewers
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'textlistViewers' ].model[i].hash"
               [title]="openAppsInThisPage[ 'textlistViewers' ].model[i].title || 'Plaintext - Viewer ' + i"
               [type]="openAppsInThisPage[ 'textlistViewers' ].type"
               [firstPopupX]="openAppsInThisPage[ 'textlistViewers' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'textlistViewers' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'textlistViewers' ].model[i].width, '250' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'textlistViewers' ].model[i].height, '150')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'textlistViewers' ].model[i].height, '150' ) + 'px',
        'width': produceHeightAndWidth( openAppsInThisPage[ 'textlistViewers' ].model[i].width, '250' ) + 'px'}">
            <app-textlist-viewer style="position: sticky;"
                                 [textToDisplay]="openAppsInThisPage[ 'textlistViewers' ].model[i]['textlist']">
            </app-textlist-viewer>
          </div>
        </popup>
      </div>

    <!-- parzivalFassung -->
    <div *ngFor="let parzivalFassung of openAppsInThisPage[ 'parzivalFassung' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" >pF {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="parzivalFassung.appear()" >Show Textlist Viewer {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'parzivalFassung' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #parzivalFassung
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'parzivalFassung' ].model[i].hash"
             [title]="openAppsInThisPage[ 'parzivalFassung' ].model[i].title || 'parzivalFassung ' + i"
             [type]="openAppsInThisPage[ 'parzivalFassung' ].type"
             [firstPopupX]="openAppsInThisPage[ 'parzivalFassung' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'parzivalFassung' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'parzivalFassung' ].model[i].width, '350' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'parzivalFassung' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'parzivalFassung' ].model[i].height, '500' ) + 'px',
        'width': produceHeightAndWidth( openAppsInThisPage[ 'parzivalFassung' ].model[i].width, '350' ) + 'px'}">
          <app-parzival-fassung style="position: sticky;"
                                [textJson]="openAppsInThisPage[ 'parzivalFassung' ].model[i]['textJson']">
          </app-parzival-fassung>
        </div>
      </popup>
    </div>

    <!-- avp-Edition -->
    <div *ngFor="let avpEditionView of openAppsInThisPage[ 'avpEditionView' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" >avpE {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="avpEditionView.appear()" >Show AVP Edition Viewer {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'avpEditionView' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #avpEditionView
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'avpEditionView' ].model[i].hash"
             [title]="openAppsInThisPage[ 'avpEditionView' ].model[i].title || 'avpEditionView ' + i"
             [type]="openAppsInThisPage[ 'avpEditionView' ].type"
             [firstPopupX]="openAppsInThisPage[ 'avpEditionView' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'avpEditionView' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'avpEditionView' ].model[i].width, '350' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'avpEditionView' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'avpEditionView' ].model[i].height, '500' ) + 'px',
        'width': produceHeightAndWidth( openAppsInThisPage[ 'avpEditionView' ].model[i].width, '350' ) + 'px'}">
          <app-p0041-edition style="position: sticky;"
                             [backendAddress]="openAppsInThisPage[ 'avpEditionView' ].model[i][ 'backendAddress' ]">
          </app-p0041-edition>
        </div>
      </popup>
    </div>

    <!-- svg-Transcription -->
    <div *ngFor="let svgTranscription of openAppsInThisPage[ 'svgTranscription' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" >svg {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="svgTranscription.appear()" >Show AVP Edition Viewer {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'svgTranscription' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #svgTranscription
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'svgTranscription' ].model[i].hash"
             [title]="openAppsInThisPage[ 'svgTranscription' ].model[i].title || 'svgTranscription ' + i"
             [type]="openAppsInThisPage[ 'svgTranscription' ].type"
             [firstPopupX]="openAppsInThisPage[ 'svgTranscription' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'svgTranscription' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'svgTranscription' ].model[i].width, '350' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'svgTranscription' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'svgTranscription' ].model[i].height, '500' ) + 'px',
        'width': produceHeightAndWidth( openAppsInThisPage[ 'svgTranscription' ].model[i].width, '350' ) + 'px'}">
          <app-text-svg-view-wrapper style="position: sticky;"
                                         [pageTree]="openAppsInThisPage['svgTranscription'].model[i]['pageTree']"
                                         [imageUrl]="openAppsInThisPage['svgTranscription'].model[i]['imageUrl']"
                                         [width]="openAppsInThisPage['svgTranscription'].model[i]['imageWidth']"
                                         [height]="openAppsInThisPage['svgTranscription'].model[i]['imageHeight']" >
          </app-text-svg-view-wrapper>
        </div>
      </popup>
    </div>

    <!-- jsonViewer -->
    <div *ngFor="let jsonViewer of openAppsInThisPage[ 'jsonViewer' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>spa</mat-icon> {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="jsonViewer.appear()" >Show Json Viewer {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'jsonViewer' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #jsonViewer
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'jsonViewer' ].model[i].hash"
             [title]="openAppsInThisPage[ 'jsonViewer' ].model[i].title || 'Textlist - Viewer ' + i"
             [type]="openAppsInThisPage[ 'jsonViewer' ].type"
             [firstPopupX]="openAppsInThisPage[ 'jsonViewer' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'jsonViewer' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'jsonViewer' ].model[i].width, '500' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'jsonViewer' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'jsonViewer' ].model[i].height, '500' ) + 'px',
        'width': produceHeightAndWidth( openAppsInThisPage[ 'jsonViewer' ].model[i].width, '500' ) + 'px'}">
          <response-tree style="position: sticky;"
                               [queryResponse]="openAppsInThisPage[ 'jsonViewer' ].model[i]['json']">
          </response-tree>
        </div>
      </popup>
    </div>

    <!-- Tree navigation -->
    <div *ngFor="let treeNavigation of openAppsInThisPage[ 'treeNavigation' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>add_to_queue</mat-icon> {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="treeNavigation.appear()" >Show Tree Navigation {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'treeNavigation' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #treeNavigation
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'treeNavigation' ].model[i].hash"
             [title]="openAppsInThisPage[ 'treeNavigation' ].model[i].title ||  'Tree navigation ' + i"
             [type]="openAppsInThisPage[ 'treeNavigation' ].type"
             [firstPopupX]="openAppsInThisPage[ 'treeNavigation' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'treeNavigation' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'treeNavigation' ].model[i].width, '400' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'treeNavigation' ].model[i].height, '600')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'treeNavigation' ].model[i].height, '600' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'treeNavigation' ].model[i].width, '400' ) + 'px'}" >
          <app-navigation-tree [queryResponse]="openAppsInThisPage[ 'treeNavigation' ].model[i]['json']">
          </app-navigation-tree>
        </div>
      </popup>
    </div>

    <!-- Result list -->
    <div *ngFor="let dataListView of openAppsInThisPage[ 'dataListView' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>spa</mat-icon> {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="dataListView.appear()" >Show Data list Viewer {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'dataListView' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #dataListView
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'dataListView' ].model[i].hash"
             [title]="openAppsInThisPage[ 'dataListView' ].model[i].title || 'Data list viewer' + i"
             [type]="openAppsInThisPage[ 'dataListView' ].type"
             [firstPopupX]="openAppsInThisPage[ 'dataListView' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'dataListView' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'dataListView' ].model[i].width, '700' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'dataListView' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'dataListView' ].model[i].height, '500' ) + 'px',
        'width': produceHeightAndWidth( openAppsInThisPage[ 'dataListView' ].model[i].width, '700' ) + 'px'}">
          <data-list-view style="position: sticky;"
                         [queryResponse]="openAppsInThisPage[ 'dataListView' ].model[i]['json']"
                          [dataListSettings]="openAppsInThisPage[ 'dataListView' ].model[i]['settings']">
          </data-list-view>
        </div>
      </popup>
    </div>

      <!-- Bar Charts -->
      <div *ngFor="let barChart of openAppsInThisPage[ 'barCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>bar_chart</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="barChart.appear()" (click)="openAppsInThisPage[ 'barCharts' ].model[i].initialized = true">Show Bar Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'barCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #barChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'barCharts' ].model[i].hash"
               [title]="openAppsInThisPage[ 'barCharts' ].model[i].title || 'Bar Chart ' + i"
               [type]="openAppsInThisPage[ 'barCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'barCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'barCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'barCharts' ].model[i].width, '1200' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'barCharts' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'barCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'barCharts' ].model[i].width, '1200' ) + 'px'}">
            <app-bar-chart
              [initialised] = "openAppsInThisPage[ 'barCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >

            </app-bar-chart>
          </div>
        </popup>
      </div>

    <!-- Spiral Bar Charts -->
    <div *ngFor="let barChart of openAppsInThisPage[ 'spiralBarCharts' ].model; let i = index;" >
      <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>bar_chart</mat-icon> {{ i }}</button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="spiralBarCharts.appear()" (click)="openAppsInThisPage[ 'spiralBarCharts' ].model[i].initialized = true">Show Spiral Bar Chart {{ i }}</button>
        <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'spiralBarCharts' ].model, i ) ">Remove this app</button>
      </mat-menu>
      <popup #spiralBarCharts
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="appFramePosition"
             [hash]="openAppsInThisPage[ 'spiralBarCharts' ].model[i].hash"
             [title]="openAppsInThisPage[ 'spiralBarCharts' ].model[i].title || 'Spiral Bar Chart ' + i"
             [type]="openAppsInThisPage[ 'spiralBarCharts' ].type"
             [firstPopupX]="openAppsInThisPage[ 'spiralBarCharts' ].model[i].x"
             [firstPopupY]="openAppsInThisPage[ 'spiralBarCharts' ].model[i].y"
             [width]="produceHeightAndWidth( openAppsInThisPage[ 'spiralBarCharts' ].model[i].width, '500' )"
             [height]="produceHeightAndWidth( openAppsInThisPage[ 'spiralBarCharts' ].model[i].height, '500')"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)">
        <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'spiralBarCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'spiralBarCharts' ].model[i].width, '500' ) + 'px'}">
          <app-spiral-bar-chart
            [initialised] = "openAppsInThisPage[ 'spiralBarCharts' ].model[i].initialized"
            [numberOfInitialisedComponent] = " i " >

          </app-spiral-bar-chart>
        </div>
      </popup>
    </div>


      <!-- Line Charts -->
      <div *ngFor="let lineChart of openAppsInThisPage[ 'lineCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>show_chart</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="lineChart.appear()" (click)="openAppsInThisPage[ 'lineCharts' ].model[i].initialized = true">Show Line Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'lineCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #lineChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'lineCharts' ].model[i].hash"
               [title]="openAppsInThisPage[ 'lineCharts' ].model[i].title || 'Line Chart ' + i"
               [type]="openAppsInThisPage[ 'lineCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'lineCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'lineCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'lineCharts' ].model[i].width, '600' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'lineCharts' ].model[i].height, '400')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'lineCharts' ].model[i].height, '400' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'lineCharts' ].model[i].width, '600' ) + 'px'}">
            <app-multi-line-chart
              [initialised] = "openAppsInThisPage[ 'lineCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >

            </app-multi-line-chart>
          </div>
        </popup>
      </div>

      <!-- Brush Zoom Charts -->
      <div *ngFor="let brushZoomChart of openAppsInThisPage[ 'brushZoomCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>insert_chart_outlined</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="brushZoomChart.appear()" (click)="openAppsInThisPage[ 'brushZoomCharts' ].model[i].initialized = true">Show Brush Zoom Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'brushZoomCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #brushZoomChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'brushZoomCharts' ].model[i].hash"
               [title]="openAppsInThisPage[ 'brushZoomCharts' ].model[i].title || 'Brush Zoom Chart ' + i"
               [type]="openAppsInThisPage[ 'brushZoomCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'brushZoomCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'brushZoomCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'brushZoomCharts' ].model[i].width, '900' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'brushZoomCharts' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'brushZoomCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'brushZoomCharts' ].model[i].width, '900' ) + 'px'}">
            <app-brush-and-zoom
              [initialised] = "openAppsInThisPage[ 'brushZoomCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >

            </app-brush-and-zoom>
          </div>
        </popup>
      </div>

      <!-- Leaflet Map -->
      <div *ngFor="let leafletMap of openAppsInThisPage[ 'leafletMaps' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>add_location</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="leafletMap.appear()" (click)="openAppsInThisPage[ 'leafletMaps' ].model[i].initialized = true">Show Leaflet Map {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'leafletMaps' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #leafletMap
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'leafletMaps' ].model[i].hash"
               [title]="openAppsInThisPage[ 'leafletMaps' ].model[i].title ||  'Leaflet Map ' + i"
               [type]="openAppsInThisPage[ 'leafletMaps' ].type"
               [firstPopupX]="openAppsInThisPage[ 'leafletMaps' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'leafletMaps' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'leafletMaps' ].model[i].width, '500' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'leafletMaps' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'leafletMaps' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'leafletMaps' ].model[i].width, '500' ) + 'px'}">
            <app-leaflet-example
              [initialised] = "openAppsInThisPage[ 'leafletMaps' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >

            </app-leaflet-example>
          </div>
        </popup>
      </div>

      <!-- Pie Chart -->
      <div *ngFor="let pieChart of openAppsInThisPage[ 'pieCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>pie_chart</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="pieChart.appear()" (click)="openAppsInThisPage[ 'pieCharts' ].model[i].initialized = true">Show Pie Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'pieCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #pieChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'pieCharts' ].model[i].hash"
               [title]="openAppsInThisPage[ 'pieCharts' ].model[i].title || 'Pie Chart ' + i"
               [type]="openAppsInThisPage[ 'pieCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'pieCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'pieCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'pieCharts' ].model[i].width, '700' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'pieCharts' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'pieCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'pieCharts' ].model[i].width, '700' ) + 'px'}">
            <app-pie-chart
              [initialised] = "openAppsInThisPage[ 'pieCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >
            </app-pie-chart>
          </div>
        </popup>
      </div>

      <!-- Radial Bar Chart -->
      <div *ngFor="let radialBarChart of openAppsInThisPage[ 'radialBarCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>multiline_chart</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="radialBarChart.appear()" (click)="openAppsInThisPage[ 'radialBarCharts' ].model[i].initialized = true">Show Radial Bar Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'radialBarCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #radialBarChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'radialBarCharts' ].model[i].hash"
               [title]="openAppsInThisPage[ 'radialBarCharts' ].model[i].title || 'Radial Bar Chart ' + i"
               [type]="openAppsInThisPage[ 'radialBarCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'radialBarCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'radialBarCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'radialBarCharts' ].model[i].width, '500' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'radialBarCharts' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'radialBarCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'radialBarCharts' ].model[i].width, '500' ) + 'px'}">
            <app-radial-barchart
              [initialised] = "openAppsInThisPage[ 'radialBarCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >
            </app-radial-barchart>
          </div>
        </popup>
      </div>

      <!-- Sankey Chart -->
      <div *ngFor="let sankeyChart of openAppsInThisPage[ 'sankeyCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>linear_scale</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="sankeyChart.appear()" (click)="openAppsInThisPage[ 'sankeyCharts' ].model[i].initialized = true">Sankey Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'sankeyCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #sankeyChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'sankeyCharts' ].model[i].title || openAppsInThisPage[ 'sankeyCharts' ].model[i].hash"
               [title]="'Sankey Chart ' + i"
               [type]="openAppsInThisPage[ 'sankeyCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'sankeyCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'sankeyCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'sankeyCharts' ].model[i].width, '900' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'sankeyCharts' ].model[i].height, '150')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'sankeyCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'sankeyCharts' ].model[i].width, '900' ) + 'px'}">
            <app-sankey
              [initialised] = "openAppsInThisPage[ 'sankeyCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >
            </app-sankey>
          </div>
        </popup>
      </div>

      <!-- Stacked Bar Chart -->
      <div *ngFor="let stackedBarChart of openAppsInThisPage[ 'stackedBarCharts' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>view_list</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="stackedBarChart.appear()" (click)="openAppsInThisPage[ 'stackedBarCharts' ].model[i].initialized = true">Stacked Bar Chart {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'stackedBarCharts' ].model, i ) ">Remove this app</button>
        </mat-menu>
        <popup #stackedBarChart
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'stackedBarCharts' ].model[i].hash"
               [title]="openAppsInThisPage[ 'stackedBarCharts' ].model[i].title ||  'Sankey Chart ' + i"
               [type]="openAppsInThisPage[ 'stackedBarCharts' ].type"
               [firstPopupX]="openAppsInThisPage[ 'stackedBarCharts' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'stackedBarCharts' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'stackedBarCharts' ].model[i].width, '800' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'stackedBarCharts' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'stackedBarCharts' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'stackedBarCharts' ].model[i].width, '800' ) + 'px'}">
            <app-stacked-bar-chart
              [initialised] = "openAppsInThisPage[ 'stackedBarCharts' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >
            </app-stacked-bar-chart>
          </div>
        </popup>
      </div>

      <!-- Chord diagram -->
      <div *ngFor="let chordDiagram of openAppsInThisPage[ 'chordDiagrams' ].model; let i = index;" >
        <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>all_out</mat-icon> {{ i }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="chordDiagram.appear()" (click)="openAppsInThisPage[ 'chordDiagrams' ].model[i].initialized = true">Chord Diagram {{ i }}</button>
          <button mat-menu-item (click)=" closeApp( openAppsInThisPage[ 'chordDiagrams' ].model, i ) ">Close this app</button>
        </mat-menu>
        <popup #chordDiagram
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'chordDiagrams' ].model[i].hash"
               [title]="openAppsInThisPage[ 'chordDiagrams' ].model[i].title || 'Chord Diagram ' + i"
               [type]="openAppsInThisPage[ 'chordDiagrams' ].type"
               [firstPopupX]="openAppsInThisPage[ 'chordDiagrams' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'chordDiagrams' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'chordDiagrams' ].model[i].width, '600' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'chordDiagrams' ].model[i].height, '500')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': produceHeightAndWidth( openAppsInThisPage[ 'chordDiagrams' ].model[i].height, '500' ) + 'px',
  'width': produceHeightAndWidth( openAppsInThisPage[ 'chordDiagrams' ].model[i].width, '600' ) + 'px'}">
            <app-chord-diagram
              [initialised] = "openAppsInThisPage[ 'chordDiagrams' ].model[i].initialized"
              [numberOfInitialisedComponent] = " i " >
            </app-chord-diagram>
          </div>
        </popup>
      </div>
<!--    </div>-->
  </mat-drawer-container>
